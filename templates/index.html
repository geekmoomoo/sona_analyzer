<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Sona Music Analyzer - ì‹œì‘ ê°€ì´ë“œ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; line-height: 1.7; color: #333; }
        h1, h2, h3 { color: #111; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .section { background-color: #f9f9f9; padding: 25px; border-radius: 8px; border: 1px solid #eee; margin-top: 30px; }
        .warning { color: #d9534f; font-weight: bold; border: 1px solid #d9534f; padding: 10px; border-radius: 5px; margin: 15px 0; }
        code { background-color: #eef; color: #333; padding: 4px 7px; border-radius: 4px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace; font-size: 0.9em;}
        .download-btn { display: inline-block; background-color: #007bff; color: white; padding: 12px 18px; text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 15px; transition: background-color 0.2s; }
        .download-btn:hover { background-color: #0056b3; }
        hr { margin: 50px 0; border: 0; border-top: 1px solid #ddd; }
        #progress-container { display: none; margin-top: 20px; }
        progress { width: 100%; height: 25px; }
        #status { font-size: 1.1em; text-align: center; }
        ol li { margin-bottom: 10px; }
    </style>
</head>
<body>
    <header style="text-align: center; margin-bottom: 40px;">
        <h1>ğŸµ Sona Music Analyzer ì‹œì‘ ê°€ì´ë“œ</h1>
        <p>ìŒì•…ì˜ íŠ¹ì§•(í…œí¬, ì—ë„ˆì§€, ë¶„ìœ„ê¸° ë“±)ì„ ì¶”ì¶œí•˜ëŠ” ë¶„ì„ ë„êµ¬ì…ë‹ˆë‹¤.</p>
    </header>

    <div class="section">
        <h2>1. ì‹œì‘í•˜ê¸° ì „ì—: í•„ìˆ˜ í”„ë¡œê·¸ë¨ ì„¤ì¹˜</h2>
        <p>ì´ ë¶„ì„ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´, ì•„ë˜ í”„ë¡œê·¸ë¨ë“¤ì´ ì»´í“¨í„°ì— ë¨¼ì € ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. (ìµœì´ˆ í•œ ë²ˆë§Œ ì„¤ì¹˜)</p>
        <ol>
            <li><strong>Python (ë²„ì „ 3.10 ê¶Œì¥):</strong> <a href="https://www.python.org/downloads/release/python-31011/" target="_blank">ì—¬ê¸°</a>ì—ì„œ 'Windows installer (64-bit)'ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì„¤ì¹˜í•˜ì„¸ìš”. <br><strong>(ì¤‘ìš”!)</strong> ì„¤ì¹˜ ì²« í™”ë©´ì—ì„œ <strong>'Add Python 3.10 to PATH' ì²´í¬ë°•ìŠ¤ë¥¼ ë°˜ë“œì‹œ ì„ íƒ</strong>í•´ì•¼ í•©ë‹ˆë‹¤.</li>
            <li><strong>FFmpeg:</strong> MP3 ë“± ë‹¤ì–‘í•œ ì˜¤ë””ì˜¤ íŒŒì¼ì„ í•´ì„í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ë²ˆì—­ê¸°ì…ë‹ˆë‹¤. <a href="https://www.gyan.dev/ffmpeg/builds/" target="_blank">ì—¬ê¸°</a>ì—ì„œ 'ffmpeg-git-full.7z'ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì••ì¶•ì„ í’€ì–´ Cë“œë¼ì´ë¸Œì— ì˜®ê¸´ ë’¤, í™˜ê²½ ë³€ìˆ˜ PATHì— <code>C:\ffmpeg\bin</code>ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</li>
        </ol>
        <p>ìœ„ í”„ë¡œê·¸ë¨ë“¤ì´ ëª¨ë‘ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•˜ì„¸ìš”.</p>
    </div>

    <div class="section">
        <h2>2. í”„ë¡œì íŠ¸ íŒŒì¼ ì¤€ë¹„</h2>
        <p>ë¶„ì„ì— í•„ìš”í•œ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë“¤ì„ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•œ ë²ˆì— ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</p>
        <a href="/download_project_files" class="download-btn" download>í”„ë¡œì íŠ¸ íŒŒì¼ ì „ì²´ ë‹¤ìš´ë¡œë“œ (.zip)</a>
        <p style="margin-top: 15px;">ë‹¤ìš´ë¡œë“œí•œ ZIP íŒŒì¼ì˜ ì••ì¶•ì„ í’€ë©´ ì•„ë˜ íŒŒì¼ë“¤ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:</p>
        <ul>
            <li><code>app.py</code> (ì›¹ ì„œë²„ ì‹¤í–‰ íŒŒì¼)</li>
            <li><code>analyze_track.py</code> (ëŒ€ëŸ‰ ë¶„ì„ìš© ìŠ¤í¬ë¦½íŠ¸)</li>
            <li><code>templates/index.html</code> (í˜„ì¬ ë³´ê³  ê³„ì‹  ì´ ì•ˆë‚´ í˜ì´ì§€)</li>
            <li><code>requirements.txt</code> (í•„ìš”í•œ íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡)</li>
        </ul>
    </div>

    <div class="section">
        <h2>3. ë¶„ì„ ë„êµ¬ ì‹¤í–‰</h2>
        <p>ì••ì¶•ì„ í‘¼ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ í„°ë¯¸ë„(PowerShell)ì„ ì—´ê³ , ì•„ë˜ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•˜ì„¸ìš”.</p>
        <ol>
            <li>
                ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë¶„ì„ì— í•„ìš”í•œ ëª¨ë“  íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•œ ë²ˆì— ì„¤ì¹˜í•©ë‹ˆë‹¤. (ìµœì´ˆ í•œ ë²ˆë§Œ ì‹¤í–‰)
                <p><code>py -m pip install -r requirements.txt</code></p>
            </li>
            <li>
                ì´ì œ ì›í•˜ëŠ” ë¶„ì„ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </li>
        </ol>

        <h3 style="margin-top: 30px;">ì˜µì…˜ A: ì›¹ ë¶„ì„ê¸° ì‹¤í–‰ (ì†ŒëŸ‰ íŒŒì¼ìš©)</h3>
        <p>í„°ë¯¸ë„ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë¡œì»¬ ì›¹ ì„œë²„ë¥¼ ì¼­ë‹ˆë‹¤.</p>
        <p><code>py app.py</code></p>
        <p>ì„œë²„ê°€ ì¼œì§€ë©´, ì›¹ ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ì— <strong><code>http://127.0.0.1:5000</code></strong>ì„ ì…ë ¥í•˜ì—¬ ì ‘ì†í•˜ì„¸ìš”. ì•„ë˜ì— ë³´ì´ëŠ” ì›¹ ë¶„ì„ê¸°ë¥¼ í†µí•´ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <h3 style="margin-top: 30px;">ì˜µì…˜ B: ëŒ€ëŸ‰ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (20ê³¡ ì´ìƒ)</h3>
        <p>ë¶„ì„í•  ìŒì•… íŒŒì¼ë“¤ì„ í”„ë¡œì íŠ¸ í´ë” ì•ˆì˜ <code>songs</code> í´ë”(ì—†ìœ¼ë©´ ìƒì„±)ì— ë„£ì€ ë’¤, í„°ë¯¸ë„ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
        <p><code>py analyze_track.py songs</code></p>
        <p>ë¶„ì„ì´ ì™„ë£Œë˜ë©´ <code>analysis_out</code> í´ë”ì— ê²°ê³¼ê°€ ì €ì¥ë©ë‹ˆë‹¤.</p>
    </div>

    <hr>

    <div class="section">
        <h2 style="text-align: center;">ğŸŒ ì›¹ ë¶„ì„ê¸°</h2>
        <form id="upload-form">
            <input type="file" id="audio-file-input" name="audio_files" accept=".mp3" multiple>
            <button type="submit" id="submit-btn">ë¶„ì„ ì‹œì‘ ë° CSV ë‹¤ìš´ë¡œë“œ</button>
        </form>
        <div id="progress-container">
            <p id="status">ë¶„ì„ ì¤€ë¹„ ì¤‘...</p>
            <progress id="progress-bar" value="0" max="100"></progress>
            <p><strong>ë¶„ì„ ì¤‘ì—ëŠ” ì ˆëŒ€ë¡œ ì´ ì°½ì„ ë‹«ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ë§ˆì„¸ìš”!</strong></p>
        </div>
    </div>

    <script>
        // (JavaScript ì½”ë“œëŠ” ì´ì „ ë²„ì „ê³¼ ë™ì¼)
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('audio-file-input');
        const submitBtn = document.getElementById('submit-btn');
        const statusDiv = document.getElementById('status');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');

        let progressInterval;

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            if (fileInput.files.length === 0) { alert('ì˜¤ë¥˜: ë¶„ì„í•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            if (fileInput.files.length > 100) { alert('ì˜¤ë¥˜: ìµœëŒ€ 100ê°œì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); return; }
            
            submitBtn.disabled = true;
            progressContainer.style.display = 'block';
            statusDiv.textContent = 'ë¶„ì„ ì„œë²„ì— ì‘ì—… ë“±ë¡ ì¤‘...';
            progressBar.value = 0;

            try {
                // 1. ì„œë²„ì— ë¶„ì„ ì‹œì‘ì„ ì•Œë¦¬ê³  ê³ ìœ í•œ ì‘ì—… IDë¥¼ ë°›ìŒ
                const startResponse = await fetch('/start_analysis', { method: 'POST' });
                if (!startResponse.ok) throw new Error('ì‘ì—… IDë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                const { job_id } = await startResponse.json();

                // 2. 2ì´ˆë§ˆë‹¤ ì§„í–‰ ìƒí™©ì„ ë¬¼ì–´ë³´ê¸° ì‹œì‘
                progressInterval = setInterval(async () => {
                    try {
                        const statusResponse = await fetch(`/analysis_status/${job_id}`);
                        if (statusResponse.ok) {
                            const progress = await statusResponse.json();
                            progressBar.value = progress.total > 0 ? (progress.current / progress.total) * 100 : 0;
                            statusDiv.textContent = progress.status;
                        } else {
                            // ì‘ì—…ì´ ëë‚˜ë©´ ì„œë²„ê°€ 404ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œ ì¸í„°ë²Œì„ ë©ˆì¶”ì§€ ì•ŠìŒ.
                        }
                    } catch (e) {
                        // Polling ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œ ì¸í„°ë²Œ ì¤‘ì§€
                        clearInterval(progressInterval);
                    }
                }, 2000);

                // 3. ì‹¤ì œ íŒŒì¼ë“¤ì„ ì—…ë¡œë“œí•˜ì—¬ ë¶„ì„ ì‹œì‘
                const formData = new FormData();
                for (const file of fileInput.files) {
                    formData.append('audio_files', file);
                }
                const analyzeResponse = await fetch(`/analyze_batch/${job_id}`, {
                    method: 'POST',
                    body: formData,
                });

                // 4. ë¶„ì„ì´ ëª¨ë‘ ëë‚˜ë©´ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ ì¤‘ì§€
                clearInterval(progressInterval);

                if (analyzeResponse.ok) {
                    progressBar.value = 100;
                    statusDiv.textContent = "âœ… ë¶„ì„ ì™„ë£Œ! íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...";
                    
                    const blob = await analyzeResponse.blob();
                    const contentDisposition = analyzeResponse.headers.get('content-disposition');
                    let filename = "analysis_summary.csv";
                    if (contentDisposition) {
                        const filenameMatch = contentDisposition.match(/filename="(.+)"/);
                        if (filenameMatch && filenameMatch.length > 1) filename = filenameMatch[1];
                    }
                    const downloadUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(downloadUrl);
                    statusDiv.innerHTML += `<br><strong>'${filename}'</strong> íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                } else {
                    const errorText = await analyzeResponse.text();
                    statusDiv.textContent = 'ì„œë²„ ì˜¤ë¥˜: ' + errorText;
                }

            } catch (error) {
                statusDiv.textContent = 'ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ë¶„ì„ ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error;
                clearInterval(progressInterval);
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>